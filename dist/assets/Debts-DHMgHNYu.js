import{_ as O,r as a,o as G,a as H,A as J,c as b,k as K,b as f,d as r,e as t,l as m,m as _,h as w,s as j,t as o,f as h,x as $,u as B,T as z,n as C,F as Q,i as W,y as F,z as X}from"./index-_Jt81qla.js";import{L as A}from"./vue3-datepicker-Cho0Wbhd.js";const Z={class:"p-6 font-inter"},ee={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},te={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},se={class:"relative"},le={class:"relative"},oe={class:"relative w-40 status-dropdown"},ne={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg overflow-hidden"},ae={class:"w-full bg-white border border-purple-200 rounded-lg overflow-hidden text-left mt-6"},re={class:"px-4 py-2"},ue={class:"w-6 h-6 rounded-md bg-[#F1ECFF] text-[rgb(98,82,254)] text-xs font-semibold flex items-center justify-center"},ie={class:"px-4 py-2"},de={class:"px-4 py-2"},ce={class:"px-4 py-2"},pe={class:"px-4 py-2"},ve={class:"mt-6 w-full rounded-xl overflow-hidden border border-[#E0D7FF]"},fe={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold text-black"},be={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},me={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},xe={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},ye={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold flex justify-between"},ge={__name:"Debts",setup(we){const i=a(null),d=a(null),c=a(!1),p=a(!1),x=a({start:"",end:""}),E=a(null),S=a(null),D=a([]);G(async()=>{document.addEventListener("click",U);try{const s=await H.get("http://localhost:3000/reports/debts");D.value=s.data.map(e=>({id:e.id,student:e.full_name,amount:e.amount_remaining,paymentDate:"-",status:"Не оплачен",comment:""}))}catch(s){console.error("Ошибка при загрузке:",s)}}),J(()=>{document.removeEventListener("click",U)});const k=b(()=>{let s=[...D.value];return v.value&&(s=s.filter(e=>e.status===v.value)),s.sort((e,n)=>e.id-n.id)});function P(s){v.value=s,u.value=!1}const R=b(()=>k.value.reduce((s,e)=>s+(e.amount||0),0)),V=b(()=>0),L=b(()=>R.value-V.value),N=b(()=>i.value&&d.value?`${y(i.value)} - ${y(d.value)}`:"не выбран"),y=s=>new Date(s).toLocaleDateString("ru-RU");function T(s){if(c.value=!c.value,c.value){p.value=!1;const e=s.target.getBoundingClientRect();x.value.start=`position: absolute; top: ${e.bottom+window.scrollY+5}px; left: ${e.left}px; z-index: 9999;`}}function M(s){if(p.value=!p.value,p.value){c.value=!1;const e=s.target.getBoundingClientRect();x.value.end=`position: absolute; top: ${e.bottom+window.scrollY+5}px; left: ${e.left}px; z-index: 9999;`}}function Y(){u.value=!u.value,c.value=!1,p.value=!1}const q=()=>{const s=k.value.map(l=>({Студент:l.student,Сумма:l.amount,Статус:l.status,Комментарий:l.comment})),e=F.json_to_sheet(s),n=F.book_new();F.book_append_sheet(n,e,"Задолженности"),X(n,"Задолженности.xlsx")},v=a(""),u=a(!1);function I(){i.value=null,d.value=null,v.value="",u.value=!1}function U(s){var l,g;const e=s.target;!((l=E.value)!=null&&l.contains(e))&&!e.closest(".start-picker-btn")&&(c.value=!1),!((g=S.value)!=null&&g.contains(e))&&!e.closest(".end-picker-btn")&&(p.value=!1);const n=document.querySelector(".status-dropdown");u.value&&n&&!n.contains(e)&&!e.closest(".filter-select")&&(u.value=!1)}return(s,e)=>{const n=K("router-link");return r(),f("div",Z,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold mb-6"},"Задолженности",-1)),t("div",ee,[m(n,{to:"/finance/reports/total-revenue",class:"tab-button"},{default:_(()=>e[4]||(e[4]=[w("Общая выручка")])),_:1,__:[4]}),m(n,{to:"/finance/reports/debts",class:"tab-button-active"},{default:_(()=>e[5]||(e[5]=[w("Задолженности")])),_:1,__:[5]}),m(n,{to:"/finance/reports/student-funding",class:"tab-button"},{default:_(()=>e[6]||(e[6]=[w("Финансирование студентов")])),_:1,__:[6]})]),t("div",te,[t("div",se,[t("button",{onClick:T,class:"filter-select w-48 start-picker-btn"},o(i.value?y(i.value):"Начало периода"),1),(r(),j(z,{to:"body"},[c.value?(r(),f("div",{key:0,class:"datepicker-popup",style:$(x.value.start),ref_key:"startPickerRef",ref:E},[m(B(A),{modelValue:i.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>i.value=l),s.closeStartPicker]},null,8,["modelValue","onUpdate:modelValue"])],4)):h("",!0)]))]),t("div",le,[t("button",{onClick:M,class:"filter-select w-48 end-picker-btn"},o(d.value?y(d.value):"Конец периода"),1),(r(),j(z,{to:"body"},[p.value?(r(),f("div",{key:0,class:"datepicker-popup",style:$(x.value.end),ref_key:"endPickerRef",ref:S},[m(B(A),{modelValue:d.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>d.value=l),s.closeEndPicker]},null,8,["modelValue","onUpdate:modelValue"])],4)):h("",!0)]))]),t("div",oe,[t("button",{onClick:Y,class:"filter-select w-full flex justify-between items-center",type:"button"},[w(o(v.value||"Статус")+" ",1),(r(),f("svg",{class:C(["w-4 h-4 ml-2 transform transition-transform duration-200",u.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[7]||(e[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),u.value?(r(),f("ul",ne,[t("li",{onClick:e[2]||(e[2]=l=>P("Оплачен")),class:C(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":v.value==="Оплачен"}])}," Оплачен ",2),t("li",{onClick:e[3]||(e[3]=l=>P("Не оплачен")),class:C(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":v.value==="Не оплачен"}])}," Не оплачен ",2)])):h("",!0)]),t("div",{class:"relative"},[t("button",{onClick:I,class:"filter-select w-full flex justify-between items-center"}," Очистить фильтры ")])]),t("table",ae,[e[9]||(e[9]=t("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[t("tr",null,[t("th",{class:"px-4 py-2 w-12"},"№"),t("th",{class:"px-4 py-2"},"Студент"),t("th",{class:"px-4 py-2"},"К оплате (тг)"),t("th",{class:"px-4 py-2"},"Дата оплаты"),t("th",{class:"px-4 py-2"},"Статус"),t("th",{class:"px-4 py-2"},"Комментарий")])],-1)),t("tbody",null,[(r(!0),f(Q,null,W(k.value,(l,g)=>(r(),f("tr",{key:l.id,class:"border-t"},[t("td",re,[t("div",ue,o(g+1),1)]),t("td",ie,o(l.student),1),t("td",de,o(l.amount.toLocaleString("ru-RU")),1),t("td",ce,o(l.paymentDate),1),e[8]||(e[8]=t("td",{class:"px-4 py-2"},[t("span",{class:"status-unpaid"},"Не оплачен")],-1)),t("td",pe,o(l.comment),1)]))),128))])]),t("div",ve,[t("div",fe," Период "+o(N.value),1),t("div",be,[e[10]||(e[10]=t("div",null,"Общая сумма платежей",-1)),t("div",null,o(R.value.toLocaleString("ru-RU"))+" ₸",1)]),t("div",me,[e[11]||(e[11]=t("div",null,"Оплаченная сумма",-1)),t("div",null,o(V.value.toLocaleString("ru-RU"))+" ₸",1)]),t("div",xe,[e[12]||(e[12]=t("div",null,"Неоплаченная сумма",-1)),t("div",null,o(L.value.toLocaleString("ru-RU"))+" ₸",1)]),t("div",ye,[e[13]||(e[13]=t("div",null,"Общая задолженность",-1)),t("div",null,o(L.value.toLocaleString("ru-RU"))+" ₸",1)])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:q,class:"download-btn"},"Сохранить в Excel")])])}}},he=O(ge,[["__scopeId","data-v-3bad581e"]]);export{he as default};
