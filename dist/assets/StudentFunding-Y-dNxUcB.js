import{_ as V,H as z,r as v,o as I,a as $,c as w,k as q,b as r,d,e as t,l as F,m as k,h as _,n as c,I as C,f as R,t as l,F as b,i as g,J as E,K as H}from"./index-BLvJSFNs.js";const J={class:"p-6 font-inter"},K={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},A={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},G={class:"relative w-56"},Q={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg"},W=["onClick"],X={class:"relative w-56"},Y={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg"},Z=["onClick"],ee={class:"w-full bg-white text-left border border-purple-200 rounded-lg overflow-hidden"},te={class:"px-4 py-2"},se={class:"inline-block bg-[#F1ECFF] text-[#6252FE] font-semibold text-xs rounded-full w-6 h-6 text-center leading-6"},ne={class:"px-4 py-2"},oe={class:"px-4 py-2"},le={class:"px-4 py-2"},ae={class:"px-4 py-2"},re={class:"px-4 py-2"},de={class:"px-4 py-2"},ce={class:"mt-6 w-full bg-white overflow-hidden rounded-xl border border-[#E0D7FF]"},ie={class:"w-full text-sm text-left border-collapse"},ue={class:"divide-y divide-[#E0D7FF]"},pe={class:"px-4 py-2"},fe={class:"px-4 py-2"},ve={class:"px-4 py-2"},_e={class:"px-4 py-2"},ye={class:"px-4 py-2"},be={class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},ge={class:"px-4 py-2"},xe={class:"px-4 py-2"},he={class:"px-4 py-2"},me={__name:"StudentFunding",setup(we){const x=z(),j=["TechOrda","Скидка 30%","Скидка 70%","Внутренний грант"],U=["100%","70%","30%"],p=v(""),f=v(""),i=v(!1),u=v(!1),S=v([]);I(async()=>{try{const n=await $.get("/api/students");S.value=n.data.map(e=>{const o=e.total_cost||0;let s=0,a="0%";e.funding_source==="TechOrda"||e.funding_source==="Внутренний грант"?(s=100,a="100%"):e.funding_source==="Скидка 70%"?(s=70,a="70%"):e.funding_source==="Скидка 30%"&&(s=30,a="30%");const m=Math.round(o*s/100),T=o-m;return{name:e.full_name,funding:e.funding_source||"Не указано",percent:a,total:o.toLocaleString("ru-RU"),covered:m.toLocaleString("ru-RU"),pay:T.toLocaleString("ru-RU"),raw:{covered:m,pay:T}}})}catch(n){console.error("Ошибка при получении данных студентов:",n)}});const L={TechOrda:1,"Скидка 70%":2,"Скидка 30%":3,"Внутренний грант":4},y=w(()=>S.value.filter(n=>{const e=!p.value||n.funding===p.value,o=!f.value||n.percent===f.value;return e&&o}).sort((n,e)=>(L[n.funding]||99)-(L[e.funding]||99)));function B(){i.value=!i.value,u.value=!1}function D(){u.value=!u.value,i.value=!1}function N(n){p.value=n,i.value=!1}function O(n){f.value=n,u.value=!1}const P=w(()=>{const n={};for(const e of y.value)n[e.funding]||(n[e.funding]={type:e.funding,count:0,percentList:[],covered:0,paid:0}),n[e.funding].count++,n[e.funding].percentList.push(e.percent),n[e.funding].covered+=e.raw.covered||0,n[e.funding].paid+=e.raw.pay||0;return Object.values(n).map(e=>{const o=[...new Set(e.percentList)];return{type:e.type,count:e.count,percent:o.length===1?o[0]:"-",covered:e.covered.toLocaleString("ru-RU"),paid:e.paid.toLocaleString("ru-RU")}})}),h=w(()=>{let n=0,e=0,o=0;for(const s of y.value)n++,e+=s.raw.covered||0,o+=s.raw.pay||0;return{count:n,covered:e.toLocaleString("ru-RU"),paid:o.toLocaleString("ru-RU")}});function M(){const n=E.json_to_sheet(y.value.map(o=>({Студент:o.name,"Тип финансирования":o.funding,"Процент покрытия":o.percent,"Стоимость обучения":o.total,"Сумма покрытия":o.covered,"К оплате":o.pay}))),e=E.book_new();E.book_append_sheet(e,n,"Финансирование"),H(e,"Финансирование.xlsx")}return(n,e)=>{const o=q("router-link");return d(),r("div",J,[e[9]||(e[9]=t("h2",{class:"text-2xl font-bold mb-6"},"Финансирование студентов",-1)),t("div",K,[F(o,{to:"/finance/reports/total-revenue",class:c(["tab-button",{"tab-button-active":C(x).path==="/finance/reports/total-revenue"}])},{default:k(()=>e[0]||(e[0]=[_(" Общая выручка")])),_:1,__:[0]},8,["class"]),F(o,{to:"/finance/reports/debts",class:c(["tab-button",{"tab-button-active":C(x).path==="/finance/reports/debts"}])},{default:k(()=>e[1]||(e[1]=[_(" Задолженности")])),_:1,__:[1]},8,["class"]),F(o,{to:"/finance/reports/student-funding",class:c(["tab-button",{"tab-button-active":C(x).path==="/finance/reports/student-funding"}])},{default:k(()=>e[2]||(e[2]=[_(" Финансирование студентов")])),_:1,__:[2]},8,["class"])]),t("div",A,[t("div",G,[t("button",{onClick:B,class:"filter-select w-full flex justify-between items-center",type:"button"},[_(l(p.value||"Тип финансирования")+" ",1),(d(),r("svg",{class:c(["w-4 h-4 ml-2 transform transition-transform duration-200",i.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[3]||(e[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),i.value?(d(),r("ul",Q,[(d(),r(b,null,g(j,s=>t("li",{key:s,onClick:a=>N(s),class:c(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":p.value===s}])},l(s),11,W)),64))])):R("",!0)]),t("div",X,[t("button",{onClick:D,class:"filter-select w-full flex justify-between items-center",type:"button"},[_(l(f.value||"Процент покрытия")+" ",1),(d(),r("svg",{class:c(["w-4 h-4 ml-2 transform transition-transform duration-200",u.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[4]||(e[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),u.value?(d(),r("ul",Y,[(d(),r(b,null,g(U,s=>t("li",{key:s,onClick:a=>O(s),class:c(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":f.value===s}])},l(s),11,Z)),64))])):R("",!0)])]),t("table",ee,[e[5]||(e[5]=t("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[t("tr",null,[t("th",{class:"px-4 py-2 w-12"},"№"),t("th",{class:"px-4 py-2"},"Студент"),t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Процент покрытия"),t("th",{class:"px-4 py-2"},"Стоимость обучения (тг)"),t("th",{class:"px-4 py-2"},"Сумма покрытия (тг)"),t("th",{class:"px-4 py-2"},"К оплате (тг)")])],-1)),t("tbody",null,[(d(!0),r(b,null,g(y.value,(s,a)=>(d(),r("tr",{key:a,class:"border-t"},[t("td",te,[t("span",se,l(a+1),1)]),t("td",ne,l(s.name),1),t("td",oe,l(s.funding),1),t("td",le,l(s.percent),1),t("td",ae,l(s.total),1),t("td",re,l(s.covered),1),t("td",de,l(s.pay),1)]))),128))])]),t("div",ce,[t("table",ie,[e[8]||(e[8]=t("thead",null,[t("tr",{class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},[t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Кол-во студентов"),t("th",{class:"px-4 py-2"},"Покрытие (%)"),t("th",{class:"px-4 py-2"},"Общая сумма покрытия (тг)"),t("th",{class:"px-4 py-2"},"Всего оплачено студентами (тг)")])],-1)),t("tbody",ue,[(d(!0),r(b,null,g(P.value,(s,a)=>(d(),r("tr",{key:a,class:"divide-x divide-[#E0D7FF]"},[t("td",pe,l(s.type),1),t("td",fe,l(s.count),1),t("td",ve,l(s.percent),1),t("td",_e,l(s.covered),1),t("td",ye,l(s.paid),1)]))),128)),t("tr",be,[e[6]||(e[6]=t("td",{class:"px-4 py-2"},"Итого",-1)),t("td",ge,l(h.value.count),1),e[7]||(e[7]=t("td",{class:"px-4 py-2"},"-",-1)),t("td",xe,l(h.value.covered),1),t("td",he,l(h.value.paid),1)])])])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:M,class:"download-btn"},"Сохранить в Excel")])])}}},ke=V(me,[["__scopeId","data-v-b6e879a9"]]);export{ke as default};
