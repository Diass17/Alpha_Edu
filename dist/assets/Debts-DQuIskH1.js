import{L as V}from"./vue3-datepicker-CYXaWZ-2.js";import{_ as G,r as u,o as H,z as J,c as m,k as K,b as i,d as r,e,l as x,m as h,h as w,q as B,t as n,f as C,s as U,p as $,T as z,n as _,F as Q,i as W,x as F,y as X}from"./index-PuXEcVkP.js";const Z={class:"p-6 font-inter"},tt={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},et={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},st={class:"relative"},ot={class:"relative"},nt={class:"relative w-40"},lt={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg overflow-hidden"},at={class:"w-full bg-white border border-purple-200 rounded-lg overflow-hidden text-left"},ut={class:"px-4 py-2"},rt={class:"w-6 h-6 rounded-md bg-[#F1ECFF] text-[rgb(98,82,254)] text-xs font-semibold flex items-center justify-center"},it={class:"px-4 py-2"},dt={class:"px-4 py-2"},ct={class:"px-4 py-2"},pt={class:"px-4 py-2"},mt={class:"px-4 py-2"},vt={class:"mt-6 w-full rounded-xl overflow-hidden border border-[#E0D7FF]"},ft={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold text-black"},bt={class:"bg-white px-6 py-4 text-sm flex justify-between items-center border-b border-gray-200/60"},xt={class:"bg-white px-6 py-4 text-sm flex justify-between items-center border-b border-gray-200/60"},yt={class:"bg-white px-6 py-4 text-sm flex justify-between items-center border-b border-gray-200/60"},gt={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold flex justify-between items-center"},wt={__name:"Debts",setup(_t){const l=u(null),a=u(null),d=u(""),c=u(!1),p=u(!1),k=u(null),D=u(null),y=u({start:"",end:""}),v=u(!1);function N(){v.value=!v.value}function E(s){d.value=s,v.value=!1}function g(s){return new Date(s).toLocaleDateString("ru-RU")}function I(s){if(c.value=!c.value,c.value){const t=s.target.getBoundingClientRect();y.value.start=`position: absolute; top: ${t.bottom+window.scrollY+5}px; left: ${t.left}px; z-index: 9999;`}}function M(s){if(p.value=!p.value,p.value){const t=s.target.getBoundingClientRect();y.value.end=`position: absolute; top: ${t.bottom+window.scrollY+5}px; left: ${t.left}px; z-index: 9999;`}}function T(){c.value=!1}function A(){p.value=!1}function S(s){k.value&&!k.value.contains(s.target)&&D.value&&!D.value.contains(s.target)&&(c.value=!1,p.value=!1)}H(()=>document.addEventListener("click",S)),J(()=>document.removeEventListener("click",S));const Y=m(()=>l.value&&a.value?`${g(l.value)} - ${g(a.value)}`:"не выбран"),f=m(()=>O.filter(s=>{const t=new Date(s.paymentDate.split(".").reverse().join("-")),b=(!l.value||t>=l.value)&&(!a.value||t<=a.value),o=!d.value||s.status===d.value;return b&&o}));m(()=>!l.value||!a.value?0:f.value.reduce((s,t)=>s+Number(t.amount.replace(".","").replace(",",".")),0));const q=()=>{const s=F.json_to_sheet(f.value),t=F.book_new();F.book_append_sheet(t,s,"Задолженности"),X(t,"Задолженности.xlsx")},O=[{student:"Сеитов А.К.",amount:"150.000",paymentDate:"13.06.2025",status:"Оплачен",comment:"Рассрочка, 2 платеж"},{student:"Муратова И.Н.",amount:"120.000",paymentDate:"31.06.2025",status:"Не оплачен",comment:"Напоминание отправлено"},{student:"Ахметов Е.М.",amount:"90.000",paymentDate:"31.06.2025",status:"Не оплачен",comment:"Рассрочка, 3 платеж"},{student:"Ким А.С.",amount:"550.000",paymentDate:"29.06.2025",status:"Не оплачен",comment:"Рассрочка, 4 платеж"},{student:"Жанабаева Р.Ш.",amount:"45.000",paymentDate:"28.06.2025",status:"Оплачен",comment:"3/4 оплачено"},{student:"Сергеев Д.И.",amount:"77.000",paymentDate:"28.06.2025",status:"Оплачен",comment:"1/2 оплачено"},{student:"Имангазин А.А.",amount:"39.000",paymentDate:"28.06.2025",status:"Не оплачен",comment:"Рассрочка, 1 платеж"},{student:"Каиров К.А.",amount:"39.000",paymentDate:"28.06.2025",status:"Не оплачен",comment:"Рассрочка, 1 платеж"},{student:"Амагелди С.В.",amount:"45,000",paymentDate:"28.06.2025",status:"Оплачен",comment:"Рассрочка, 1 платеж"},{student:"Бейсенова С.А.",amount:"39.000",paymentDate:"28.06.2025",status:"Не оплачен",comment:"Рассрочка, 3 платеж"},{student:"Сеитов Д.Ш.",amount:"100,000",paymentDate:"28.06.2025",status:"Оплачен",comment:"1/2 оплачено"}],P=m(()=>!l.value||!a.value?0:f.value.reduce((s,t)=>s+parseInt(t.amount.replace(/\D/g,""))||0,0)),R=m(()=>!l.value||!a.value?0:f.value.filter(s=>s.status==="Оплачен").reduce((s,t)=>s+parseInt(t.amount.replace(/\D/g,""))||0,0)),j=m(()=>P.value-R.value);return(s,t)=>{const b=K("router-link");return r(),i("div",Z,[t[13]||(t[13]=e("h2",{class:"text-2xl font-bold mb-6"},"Задолженности",-1)),e("div",tt,[x(b,{to:"/finance/reports/total-revenue",class:"tab-button"},{default:h(()=>t[4]||(t[4]=[w("Общая выручка")])),_:1,__:[4]}),x(b,{to:"/finance/reports/debts",class:"tab-button-active"},{default:h(()=>t[5]||(t[5]=[w("Задолженности")])),_:1,__:[5]}),x(b,{to:"/finance/reports/student-funding",class:"tab-button"},{default:h(()=>t[6]||(t[6]=[w("Финансирование студентов")])),_:1,__:[6]})]),e("div",et,[e("div",st,[e("button",{onClick:I,class:"filter-select w-48"},n(l.value?g(l.value):"Начало периода"),1),(r(),B(z,{to:"body"},[c.value?(r(),i("div",{key:0,class:"datepicker-popup",style:U(y.value.start),ref_key:"startPickerRef",ref:k},[x($(V),{modelValue:l.value,"onUpdate:modelValue":[t[0]||(t[0]=o=>l.value=o),T]},null,8,["modelValue"])],4)):C("",!0)]))]),e("div",ot,[e("button",{onClick:M,class:"filter-select w-48"},n(a.value?g(a.value):"Конец периода"),1),(r(),B(z,{to:"body"},[p.value?(r(),i("div",{key:0,class:"datepicker-popup",style:U(y.value.end),ref_key:"endPickerRef",ref:D},[x($(V),{modelValue:a.value,"onUpdate:modelValue":[t[1]||(t[1]=o=>a.value=o),A]},null,8,["modelValue"])],4)):C("",!0)]))]),e("div",nt,[e("button",{onClick:N,class:"filter-select w-full flex justify-between items-center",type:"button"},[w(n(d.value||"Статус")+" ",1),(r(),i("svg",{class:_(["w-4 h-4 ml-2 transform transition-transform duration-200",v.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[7]||(t[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),v.value?(r(),i("ul",lt,[e("li",{onClick:t[2]||(t[2]=o=>E("Оплачен")),class:_(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":d.value==="Оплачен"}])}," Оплачен ",2),e("li",{onClick:t[3]||(t[3]=o=>E("Не оплачен")),class:_(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":d.value==="Не оплачен"}])}," Не оплачен ",2)])):C("",!0)])]),e("table",at,[t[8]||(t[8]=e("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[e("tr",null,[e("th",{class:"px-4 py-2 w-12"},"№"),e("th",{class:"px-4 py-2"},"Студент"),e("th",{class:"px-4 py-2"},"К оплате (тг)"),e("th",{class:"px-4 py-2"},"Дата оплаты"),e("th",{class:"px-4 py-2"},"Статус"),e("th",{class:"px-4 py-2"},"Комментарий")])],-1)),e("tbody",null,[(r(!0),i(Q,null,W(f.value,(o,L)=>(r(),i("tr",{key:L,class:"border-t"},[e("td",ut,[e("div",rt,n(L+1),1)]),e("td",it,n(o.student),1),e("td",dt,n(o.amount),1),e("td",ct,n(o.paymentDate),1),e("td",pt,[e("span",{class:_(o.status==="Оплачен"?"status-paid":"status-unpaid")},n(o.status),3)]),e("td",mt,n(o.comment),1)]))),128))])]),e("div",vt,[e("div",ft," Период "+n(Y.value),1),e("div",bt,[t[9]||(t[9]=e("div",null,"Общая сумма платежей",-1)),e("div",null,n(P.value.toLocaleString("ru-RU"))+" ₸",1)]),e("div",xt,[t[10]||(t[10]=e("div",null,"Оплаченная сумма",-1)),e("div",null,n(R.value.toLocaleString("ru-RU"))+" ₸",1)]),e("div",yt,[t[11]||(t[11]=e("div",null,"Неоплаченная сумма",-1)),e("div",null,n(j.value.toLocaleString("ru-RU"))+" ₸",1)]),e("div",gt,[t[12]||(t[12]=e("div",null,"Общая задолженность",-1)),e("div",null,n(j.value.toLocaleString("ru-RU"))+" ₸",1)])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:q,class:"download-btn"}," Сохранить в Excel ")])])}}},ht=G(wt,[["__scopeId","data-v-2983aa65"]]);export{ht as default};
