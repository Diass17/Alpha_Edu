import{d as z,r as n,o as N,a as U,c as R,b as A,e as o,f as t,g as h,w as T,v as I,n as f,_ as G,h as w,t as c,F as k,i as y,j as H,k as a,l as J}from"./index-BVcBlwH-.js";import{_ as K}from"./search-CKZYpkUj.js";const Q={class:"student-payments"},W={class:"top-bar"},X={class:"search-wrapper"},Y={class:"filter-button-wrapper"},Z={class:"filter-bar"},ee={key:0,class:"filters-box"},te={class:"relative w-48"},se={key:0,class:"funding-dropdown absolute z-10 w-full mt-2 bg-white border rounded-lg shadow-md"},le=["onClick"],ne={key:0,class:"text-[rgb(98,82,254)]"},oe={class:"relative w-56"},ae={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg"},re=["onClick"],ue={class:"filter-select checkbox-style"},ie={class:"student-table"},ce=["onClick"],de={class:"w-6 h-6 rounded-md bg-[#F1EFFF] text-[rgb(98,82,254)] text-xs font-semibold flex items-center justify-center"},ve=z({__name:"StudentPayments",setup(fe){const g=n(""),m=n(!1),r=n([]),v=n(""),p=n(!1),u=n(!1),d=n(!1),b=n(!1),_=n(!1),x=n(!1),P=["TechOrda","Скидка 70%","Скидка 30%","Внутренний грант","Полная оплата"],V=["Студент","Выпускник"],C=n([]),B=()=>{m.value=!m.value},E=()=>{u.value=!u.value,b.value=!1,_.value=!1,x.value=!1},L=()=>{d.value=!d.value,u.value=!1},M=l=>{v.value=l,d.value=!1},O=l=>{const e=r.value.indexOf(l);e===-1?r.value.push(l):r.value.splice(e,1)};N(async()=>{document.addEventListener("click",j);try{const l=await U.get("/api/students");C.value=l.data.map(e=>({id:e.id,name:e.full_name,iin:e.iin,source:e.funding_source||"Не указано",status:e.status,paid:e.paid_amount,remaining:e.amount_remaining,debt:e.amount_remaining>0}))}catch(l){console.error("Ошибка при загрузке студентов:",l)}});const $=R(()=>C.value.filter(l=>{const e=l.name.toLowerCase().includes(g.value.toLowerCase()),s=r.value.length===0||r.value.includes(l.source),i=!v.value||l.status===v.value,D=!p.value||l.debt;return e&&s&&i&&D}).sort((l,e)=>l.id-e.id));function q(){r.value=[],v.value="",p.value=!1,b.value=!1,u.value=!1}const S=n(null),F=n(null);function j(l){const e=l.target,s=document.querySelector(".funding-dropdown");u.value&&s&&!s.contains(e)&&!e.closest(".filter-select")&&(u.value=!1),document.querySelector(".status-dropdown"),d.value&&!e.closest(".filter-select")&&(d.value=!1),S.value&&!S.value.contains(e)&&!e.closest(".start-picker-btn")&&(_.value=!1),F.value&&!F.value.contains(e)&&!e.closest(".end-picker-btn")&&(x.value=!1);const i=document.querySelector(".course-dropdown");b.value&&i&&!i.contains(e)&&!e.closest(".filter-select")&&(b.value=!1)}return A(()=>{document.removeEventListener("click",j)}),(l,e)=>(a(),o("div",Q,[t("div",W,[e[3]||(e[3]=t("h2",null,"Оплаты студентов",-1)),t("div",X,[e[2]||(e[2]=t("img",{src:K,class:"search-icon"},null,-1)),T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),type:"text",placeholder:"Поиск",class:"search-input"},null,512),[[I,g.value]])])]),t("div",Y,[t("div",Z,[t("button",{class:f(["filter-btn",{"filter-btn--active":m.value}]),onClick:B,type:"button"},e[4]||(e[4]=[t("img",{src:G,class:"filter-icon"},null,-1),t("span",null,"Фильтр",-1)]),2)])]),m.value?(a(),o("div",ee,[t("div",te,[t("button",{onClick:E,class:"filter-select w-full flex justify-between items-center",type:"button"},[w(c(r.value.length?r.value.join(", "):"Тип финансирования")+" ",1),(a(),o("svg",{class:f(["w-4 h-4 ml-2 transform transition-transform duration-200",u.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),u.value?(a(),o("ul",se,[(a(),o(k,null,y(P,s=>t("li",{key:s,onClick:i=>O(s),class:"cursor-pointer px-4 py-2 hover:bg-gray-100 flex justify-between items-center"},[t("span",{class:f({"text-[rgb(98,82,254)] font-medium":r.value.includes(s)})},c(s),3),r.value.includes(s)?(a(),o("span",ne,"✔")):h("",!0)],8,le)),64))])):h("",!0)]),t("div",oe,[t("button",{onClick:L,class:"filter-select w-full flex justify-between items-center",type:"button"},[w(c(v.value||"Статус")+" ",1),(a(),o("svg",{class:f(["w-4 h-4 ml-2 transform transition-transform duration-200",d.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[6]||(e[6]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),d.value?(a(),o("ul",ae,[(a(),o(k,null,y(V,s=>t("li",{key:s,onClick:i=>M(s),class:f(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":v.value===s}])},c(s),11,re)),64))])):h("",!0)]),t("label",ue,[T(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s)},null,512),[[H,p.value]]),e[7]||(e[7]=w(" Только с долгами "))]),t("div",{class:"relative"},[t("button",{onClick:q,class:"filter-select w-full flex justify-between items-center"}," Очистить фильтры ")])])):h("",!0),t("table",ie,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",{class:"w-12"},"#"),t("th",null,"Студент"),t("th",null,"ИИН"),t("th",null,"Финансирование")])],-1)),t("tbody",null,[(a(!0),o(k,null,y($.value,(s,i)=>(a(),o("tr",{key:s.id,onClick:D=>l.$router.push({name:"StudentPaymentCalendar",params:{id:s.id}}),class:"cursor-pointer"},[t("td",null,[t("div",de,c(i+1),1)]),t("td",null,c(s.name),1),t("td",null,c(s.iin),1),t("td",null,c(s.source),1)],8,ce))),128))])])]))}}),be=J(ve,[["__scopeId","data-v-f1b77b5c"]]);export{be as default};
