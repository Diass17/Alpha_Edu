import{_ as N,q as B,r as g,o as V,a as z,A as M,c as b,k as P,b as r,d as c,e as t,l as x,m as h,h as v,n as p,u as m,f as T,t as l,F as w,i as F,y as k,z as A}from"./index-UKxEofdn.js";const I={class:"p-6 font-inter"},$={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},G={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},H={class:"relative w-56"},J={key:0,class:"funding-dropdown absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},K=["onClick"],Q={key:0,class:"text-[rgb(98,82,254)]"},W={class:"w-full bg-white text-left border border-purple-200 rounded-lg overflow-hidden"},X={class:"px-4 py-2"},Y={class:"inline-block bg-[#F1ECFF] text-[#6252FE] font-semibold text-xs rounded-full w-6 h-6 text-center leading-6"},Z={class:"px-4 py-2"},ee={class:"px-4 py-2"},te={class:"px-4 py-2"},ne={class:"px-4 py-2"},se={class:"px-4 py-2"},oe={class:"mt-6 w-full bg-white overflow-hidden rounded-xl border border-[#E0D7FF]"},le={class:"w-full text-sm text-left border-collapse"},ae={class:"divide-y divide-[#E0D7FF]"},de={class:"px-4 py-2"},re={class:"px-4 py-2"},ce={class:"px-4 py-2"},ie={class:"px-4 py-2"},ue={class:"px-4 py-2"},pe={class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},fe={class:"px-4 py-2"},ve={class:"px-4 py-2"},ye={class:"px-4 py-2"},_e={__name:"StudentFunding",setup(ge){const y=B(),j=["TechOrda","Скидка 30%","Скидка 70%","Внутренний грант","Полная оплата"],d=g([]),i=g(!1),S=g([]);V(async()=>{try{const s=await z.get("/api/students");document.addEventListener("click",C),S.value=s.data.map(e=>{const o=e.total_cost||0;let n=0,a="0%";e.funding_source==="TechOrda"||e.funding_source==="Внутренний грант"?(n=100,a="100%"):e.funding_source==="Скидка 70%"?(n=70,a="70%"):e.funding_source==="Скидка 30%"?(n=30,a="30%"):e.funding_source==="Полная оплата"&&(n=0,a="-");const u=Math.round(o*n/100),L=o-u;return{name:e.full_name,funding:e.funding_source||"Не указано",percent:a,total:o.toLocaleString("ru-RU"),covered:u.toLocaleString("ru-RU"),pay:L.toLocaleString("ru-RU"),raw:{covered:u,pay:L}}})}catch(s){console.error("Ошибка при получении данных студентов:",s)}}),M(()=>{document.removeEventListener("click",C)});const E={TechOrda:1,"Скидка 70%":2,"Скидка 30%":3,"Внутренний грант":4},f=b(()=>S.value.filter(s=>d.value.length===0||d.value.includes(s.funding)).sort((s,e)=>(E[s.funding]||99)-(E[e.funding]||99)));function q(){i.value=!i.value}function R(s){const e=d.value.indexOf(s);e===-1?d.value.push(s):d.value.splice(e,1)}const U=b(()=>{const s={};for(const e of f.value)s[e.funding]||(s[e.funding]={type:e.funding,count:0,percentList:[],covered:0,paid:0}),s[e.funding].count++,s[e.funding].percentList.push(e.percent),s[e.funding].covered+=e.raw.covered||0,s[e.funding].paid+=e.raw.pay||0;return Object.values(s).map(e=>{const o=[...new Set(e.percentList)];return{type:e.type,count:e.count,percent:o.length===1?o[0]:"-",covered:e.covered.toLocaleString("ru-RU"),paid:e.paid.toLocaleString("ru-RU")}})});function C(s){var a,u;const e=s.target;document.querySelector(".funding-dropdown"),document.querySelector(".funding-btn");const o=document.querySelector(".coverage-dropdown"),n=document.querySelector(".coverage-btn");i.value&&!((a=document.querySelector(".funding-dropdown"))!=null&&a.contains(e))&&!((u=document.querySelector(".funding-btn"))!=null&&u.contains(e))&&(i.value=!1),showCoveragePercent.value&&!(o!=null&&o.contains(e))&&!(n!=null&&n.contains(e))&&(showCoveragePercent.value=!1)}function O(){d.value=[],i.value=!1}const _=b(()=>{let s=0,e=0,o=0;for(const n of f.value)s++,e+=n.raw.covered||0,o+=n.raw.pay||0;return{count:s,covered:e.toLocaleString("ru-RU"),paid:o.toLocaleString("ru-RU")}});function D(){const s=k.json_to_sheet(f.value.map(o=>({Студент:o.name,"Тип финансирования":o.funding,"Стоимость обучения":o.total,"Сумма покрытия":o.covered,"К оплате":o.pay}))),e=k.book_new();k.book_append_sheet(e,s,"Финансирование"),A(e,"Финансирование.xlsx")}return(s,e)=>{const o=P("router-link");return c(),r("div",I,[e[8]||(e[8]=t("h2",{class:"text-2xl font-bold mb-6"},"Финансирование студентов",-1)),t("div",$,[x(o,{to:"/finance/reports/total-revenue",class:p(["tab-button",{"tab-button-active":m(y).path==="/finance/reports/total-revenue"}])},{default:h(()=>e[0]||(e[0]=[v(" Общая выручка")])),_:1,__:[0]},8,["class"]),x(o,{to:"/finance/reports/debts",class:p(["tab-button",{"tab-button-active":m(y).path==="/finance/reports/debts"}])},{default:h(()=>e[1]||(e[1]=[v(" Задолженности")])),_:1,__:[1]},8,["class"]),x(o,{to:"/finance/reports/student-funding",class:p(["tab-button",{"tab-button-active":m(y).path==="/finance/reports/student-funding"}])},{default:h(()=>e[2]||(e[2]=[v(" Финансирование студентов")])),_:1,__:[2]},8,["class"])]),t("div",G,[t("div",H,[t("button",{onClick:q,class:"filter-select w-full flex justify-between items-center funding-btn",type:"button"},[v(l(d.value.length?d.value.join(", "):"Тип финансирования")+" ",1),(c(),r("svg",{class:p(["w-4 h-4 ml-2 transform transition-transform duration-200",i.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[3]||(e[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),i.value?(c(),r("ul",J,[(c(),r(w,null,F(j,n=>t("li",{key:n,onClick:a=>R(n),class:"cursor-pointer px-4 py-2 hover:bg-gray-100 flex justify-between items-center"},[t("span",{class:p({"text-[rgb(98,82,254)] font-medium":d.value.includes(n)})},l(n),3),d.value.includes(n)?(c(),r("span",Q,"✔")):T("",!0)],8,K)),64))])):T("",!0)]),t("div",{class:"relative"},[t("button",{onClick:O,class:"filter-select w-full flex justify-between items-center coverage-btn",type:"button"}," Очистить фильтры ")])]),t("table",W,[e[4]||(e[4]=t("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[t("tr",null,[t("th",{class:"px-4 py-2 w-12"},"№"),t("th",{class:"px-4 py-2"},"Студент"),t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Стоимость обучения (тг)"),t("th",{class:"px-4 py-2"},"Cумма скидки (тг)"),t("th",{class:"px-4 py-2"},"К оплате (тг)")])],-1)),t("tbody",null,[(c(!0),r(w,null,F(f.value,(n,a)=>(c(),r("tr",{key:a,class:"border-t"},[t("td",X,[t("span",Y,l(a+1),1)]),t("td",Z,l(n.name),1),t("td",ee,l(n.funding),1),t("td",te,l(n.total),1),t("td",ne,l(n.covered),1),t("td",se,l(n.pay),1)]))),128))])]),t("div",oe,[t("table",le,[e[7]||(e[7]=t("thead",null,[t("tr",{class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},[t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Кол-во студентов"),t("th",{class:"px-4 py-2"},"Покрытие (%)"),t("th",{class:"px-4 py-2"},"Общая сумма покрытия (тг)"),t("th",{class:"px-4 py-2"},"Всего оплачено студентами (тг)")])],-1)),t("tbody",ae,[(c(!0),r(w,null,F(U.value,(n,a)=>(c(),r("tr",{key:a,class:"divide-x divide-[#E0D7FF]"},[t("td",de,l(n.type),1),t("td",re,l(n.count),1),t("td",ce,l(n.percent),1),t("td",ie,l(n.covered),1),t("td",ue,l(n.paid),1)]))),128)),t("tr",pe,[e[5]||(e[5]=t("td",{class:"px-4 py-2"},"Итого",-1)),t("td",fe,l(_.value.count),1),e[6]||(e[6]=t("td",{class:"px-4 py-2"},"-",-1)),t("td",ve,l(_.value.covered),1),t("td",ye,l(_.value.paid),1)])])])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:D,class:"download-btn"},"Сохранить в Excel")])])}}},xe=N(_e,[["__scopeId","data-v-3a87f90d"]]);export{xe as default};
