import{_ as T,r as v,o as A,a as M,c as f,k as C,b as r,d as n,e,l as b,m as g,h as x,z as E,t as o,f as y,x as P,T as R,n as k,F as Y,i as I,J as _,K as J}from"./index-BLvJSFNs.js";const K={class:"p-6 font-inter"},q={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},G={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},H={class:"relative"},O={class:"relative"},Q={class:"relative w-40"},W={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg overflow-hidden"},X={class:"w-full bg-white border border-purple-200 rounded-lg overflow-hidden text-left mt-6"},Z={class:"px-4 py-2"},tt={class:"w-6 h-6 rounded-md bg-[#F1ECFF] text-[rgb(98,82,254)] text-xs font-semibold flex items-center justify-center"},et={class:"px-4 py-2"},st={class:"px-4 py-2"},ot={class:"px-4 py-2"},lt={class:"px-4 py-2"},nt={class:"mt-6 w-full rounded-xl overflow-hidden border border-[#E0D7FF]"},at={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold text-black"},rt={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},dt={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},it={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},ut={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold flex justify-between"},pt={__name:"Debts",setup(ct){const d=v(null),i=v(null),p=v(!1),c=v(!1),h=v([]);A(async()=>{try{const s=await M.get("http://localhost:3000/reports/debts");h.value=s.data.map(t=>({id:t.id,student:t.full_name,amount:t.amount_remaining,paymentDate:"-",status:"Не оплачен",comment:""}))}catch(s){console.error("Ошибка при загрузке:",s)}});const w=f(()=>[...h.value].sort((s,t)=>s.id-t.id)),S=f(()=>w.value.reduce((s,t)=>s+(t.amount||0),0)),D=f(()=>0),F=f(()=>S.value-D.value),V=f(()=>d.value&&i.value?`${m(d.value)} - ${m(i.value)}`:"не выбран"),m=s=>new Date(s).toLocaleDateString("ru-RU");function j(s){if(p.value=!p.value,p.value){const t=s.target.getBoundingClientRect();popupPosition.value.start=`position: absolute; top: ${t.bottom+window.scrollY+5}px; left: ${t.left}px; z-index: 9999;`}}function U(s){if(c.value=!c.value,c.value){const t=s.target.getBoundingClientRect();popupPosition.value.end=`position: absolute; top: ${t.bottom+window.scrollY+5}px; left: ${t.left}px; z-index: 9999;`}}const $=()=>{p.value=!1},B=()=>{c.value=!1};function L(){showStatusDropdown.value=!showStatusDropdown.value}const z=()=>{const s=w.value.map(a=>({Студент:a.student,Сумма:a.amount,Статус:a.status,Комментарий:a.comment})),t=_.json_to_sheet(s),u=_.book_new();_.book_append_sheet(u,t,"Задолженности"),J(u,"Задолженности.xlsx")};return(s,t)=>{const u=C("router-link"),a=C("Datepicker");return n(),r("div",K,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold mb-6"},"Задолженности",-1)),e("div",q,[b(u,{to:"/finance/reports/total-revenue",class:"tab-button"},{default:g(()=>t[4]||(t[4]=[x("Общая выручка")])),_:1,__:[4]}),b(u,{to:"/finance/reports/debts",class:"tab-button-active"},{default:g(()=>t[5]||(t[5]=[x("Задолженности")])),_:1,__:[5]}),b(u,{to:"/finance/reports/student-funding",class:"tab-button"},{default:g(()=>t[6]||(t[6]=[x("Финансирование студентов")])),_:1,__:[6]})]),e("div",G,[e("div",H,[e("button",{onClick:j,class:"filter-select w-48"},o(d.value?m(d.value):"Начало периода"),1),(n(),E(R,{to:"body"},[p.value?(n(),r("div",{key:0,class:"datepicker-popup",style:P(s.popupPosition.start),ref:"startPickerRef"},[b(a,{modelValue:d.value,"onUpdate:modelValue":[t[0]||(t[0]=l=>d.value=l),$]},null,8,["modelValue"])],4)):y("",!0)]))]),e("div",O,[e("button",{onClick:U,class:"filter-select w-48"},o(i.value?m(i.value):"Конец периода"),1),(n(),E(R,{to:"body"},[c.value?(n(),r("div",{key:0,class:"datepicker-popup",style:P(s.popupPosition.end),ref:"endPickerRef"},[b(a,{modelValue:i.value,"onUpdate:modelValue":[t[1]||(t[1]=l=>i.value=l),B]},null,8,["modelValue"])],4)):y("",!0)]))]),e("div",Q,[e("button",{onClick:L,class:"filter-select w-full flex justify-between items-center",type:"button"},[x(o(s.selectedStatus||"Статус")+" ",1),(n(),r("svg",{class:k(["w-4 h-4 ml-2 transform transition-transform duration-200",s.showStatusDropdown?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[7]||(t[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),s.showStatusDropdown?(n(),r("ul",W,[e("li",{onClick:t[2]||(t[2]=l=>s.selectStatus("Оплачен")),class:k(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":s.selectedStatus==="Оплачен"}])}," Оплачен ",2),e("li",{onClick:t[3]||(t[3]=l=>s.selectStatus("Не оплачен")),class:k(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":s.selectedStatus==="Не оплачен"}])}," Не оплачен ",2)])):y("",!0)])]),e("table",X,[t[9]||(t[9]=e("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[e("tr",null,[e("th",{class:"px-4 py-2 w-12"},"№"),e("th",{class:"px-4 py-2"},"Студент"),e("th",{class:"px-4 py-2"},"К оплате (тг)"),e("th",{class:"px-4 py-2"},"Дата оплаты"),e("th",{class:"px-4 py-2"},"Статус"),e("th",{class:"px-4 py-2"},"Комментарий")])],-1)),e("tbody",null,[(n(!0),r(Y,null,I(w.value,(l,N)=>(n(),r("tr",{key:l.id,class:"border-t"},[e("td",Z,[e("div",tt,o(N+1),1)]),e("td",et,o(l.student),1),e("td",st,o(l.amount.toLocaleString("ru-RU")),1),e("td",ot,o(l.paymentDate),1),t[8]||(t[8]=e("td",{class:"px-4 py-2"},[e("span",{class:"status-unpaid"},"Не оплачен")],-1)),e("td",lt,o(l.comment),1)]))),128))])]),e("div",nt,[e("div",at," Период "+o(V.value),1),e("div",rt,[t[10]||(t[10]=e("div",null,"Общая сумма платежей",-1)),e("div",null,o(S.value.toLocaleString("ru-RU"))+" ₸",1)]),e("div",dt,[t[11]||(t[11]=e("div",null,"Оплаченная сумма",-1)),e("div",null,o(D.value.toLocaleString("ru-RU"))+" ₸",1)]),e("div",it,[t[12]||(t[12]=e("div",null,"Неоплаченная сумма",-1)),e("div",null,o(F.value.toLocaleString("ru-RU"))+" ₸",1)]),e("div",ut,[t[13]||(t[13]=e("div",null,"Общая задолженность",-1)),e("div",null,o(F.value.toLocaleString("ru-RU"))+" ₸",1)])]),e("div",{class:"mt-4 flex justify-end"},[e("button",{onClick:z,class:"download-btn"},"Сохранить в Excel")])])}}},ft=T(pt,[["__scopeId","data-v-6f812406"]]);export{ft as default};
