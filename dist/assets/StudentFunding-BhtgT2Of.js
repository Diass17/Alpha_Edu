import{_ as N,I as D,r as b,o as P,a as V,L as B,c as g,k as M,b as d,d as c,e as t,l as x,m as h,h as v,n as p,H as m,f as z,t as l,F as w,i as F,J as k,K as I}from"./index-Cm74ER4k.js";const H={class:"p-6 font-inter"},J={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},K={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},$={class:"relative w-56"},A={key:0,class:"funding-dropdown absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg"},G=["onClick"],Q={class:"w-full bg-white text-left border border-purple-200 rounded-lg overflow-hidden"},W={class:"px-4 py-2"},X={class:"inline-block bg-[#F1ECFF] text-[#6252FE] font-semibold text-xs rounded-full w-6 h-6 text-center leading-6"},Y={class:"px-4 py-2"},Z={class:"px-4 py-2"},ee={class:"px-4 py-2"},te={class:"px-4 py-2"},ne={class:"px-4 py-2"},se={class:"mt-6 w-full bg-white overflow-hidden rounded-xl border border-[#E0D7FF]"},oe={class:"w-full text-sm text-left border-collapse"},le={class:"divide-y divide-[#E0D7FF]"},ae={class:"px-4 py-2"},re={class:"px-4 py-2"},de={class:"px-4 py-2"},ce={class:"px-4 py-2"},ie={class:"px-4 py-2"},ue={class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},pe={class:"px-4 py-2"},fe={class:"px-4 py-2"},ve={class:"px-4 py-2"},_e={__name:"StudentFunding",setup(ye){const _=D(),T=["TechOrda","Скидка 30%","Скидка 70%","Внутренний грант","Полная оплата"],u=b(""),r=b(!1),C=b([]);P(async()=>{try{const s=await V.get("/api/students");document.addEventListener("click",S),C.value=s.data.map(e=>{const o=e.total_cost||0;let n=0,a="0%";e.funding_source==="TechOrda"||e.funding_source==="Внутренний грант"?(n=100,a="100%"):e.funding_source==="Скидка 70%"?(n=70,a="70%"):e.funding_source==="Скидка 30%"?(n=30,a="30%"):e.funding_source==="Полная оплата"&&(n=0,a="-");const i=Math.round(o*n/100),L=o-i;return{name:e.full_name,funding:e.funding_source||"Не указано",percent:a,total:o.toLocaleString("ru-RU"),covered:i.toLocaleString("ru-RU"),pay:L.toLocaleString("ru-RU"),raw:{covered:i,pay:L}}})}catch(s){console.error("Ошибка при получении данных студентов:",s)}}),B(()=>{document.removeEventListener("click",S)});const E={TechOrda:1,"Скидка 70%":2,"Скидка 30%":3,"Внутренний грант":4},f=g(()=>C.value.filter(s=>!u.value||s.funding===u.value).sort((s,e)=>(E[s.funding]||99)-(E[e.funding]||99)));function R(){r.value=!r.value,showCoveragePercent.value=!1}function U(s){u.value=s,r.value=!1}const j=g(()=>{const s={};for(const e of f.value)s[e.funding]||(s[e.funding]={type:e.funding,count:0,percentList:[],covered:0,paid:0}),s[e.funding].count++,s[e.funding].percentList.push(e.percent),s[e.funding].covered+=e.raw.covered||0,s[e.funding].paid+=e.raw.pay||0;return Object.values(s).map(e=>{const o=[...new Set(e.percentList)];return{type:e.type,count:e.count,percent:o.length===1?o[0]:"-",covered:e.covered.toLocaleString("ru-RU"),paid:e.paid.toLocaleString("ru-RU")}})});function S(s){const e=s.target,o=document.querySelector(".funding-dropdown"),n=document.querySelector(".funding-btn"),a=document.querySelector(".coverage-dropdown"),i=document.querySelector(".coverage-btn");r.value&&!(o!=null&&o.contains(e))&&!(n!=null&&n.contains(e))&&(r.value=!1),showCoveragePercent.value&&!(a!=null&&a.contains(e))&&!(i!=null&&i.contains(e))&&(showCoveragePercent.value=!1)}function O(){u.value="",r.value=!1}const y=g(()=>{let s=0,e=0,o=0;for(const n of f.value)s++,e+=n.raw.covered||0,o+=n.raw.pay||0;return{count:s,covered:e.toLocaleString("ru-RU"),paid:o.toLocaleString("ru-RU")}});function q(){const s=k.json_to_sheet(f.value.map(o=>({Студент:o.name,"Тип финансирования":o.funding,"Стоимость обучения":o.total,"Сумма покрытия":o.covered,"К оплате":o.pay}))),e=k.book_new();k.book_append_sheet(e,s,"Финансирование"),I(e,"Финансирование.xlsx")}return(s,e)=>{const o=M("router-link");return c(),d("div",H,[e[8]||(e[8]=t("h2",{class:"text-2xl font-bold mb-6"},"Финансирование студентов",-1)),t("div",J,[x(o,{to:"/finance/reports/total-revenue",class:p(["tab-button",{"tab-button-active":m(_).path==="/finance/reports/total-revenue"}])},{default:h(()=>e[0]||(e[0]=[v(" Общая выручка")])),_:1,__:[0]},8,["class"]),x(o,{to:"/finance/reports/debts",class:p(["tab-button",{"tab-button-active":m(_).path==="/finance/reports/debts"}])},{default:h(()=>e[1]||(e[1]=[v(" Задолженности")])),_:1,__:[1]},8,["class"]),x(o,{to:"/finance/reports/student-funding",class:p(["tab-button",{"tab-button-active":m(_).path==="/finance/reports/student-funding"}])},{default:h(()=>e[2]||(e[2]=[v(" Финансирование студентов")])),_:1,__:[2]},8,["class"])]),t("div",K,[t("div",$,[t("button",{onClick:R,class:"filter-select w-full flex justify-between items-center funding-btn",type:"button"},[v(l(u.value||"Тип финансирования")+" ",1),(c(),d("svg",{class:p(["w-4 h-4 ml-2 transform transition-transform duration-200",r.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[3]||(e[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),r.value?(c(),d("ul",A,[(c(),d(w,null,F(T,n=>t("li",{key:n,onClick:a=>U(n),class:p(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":u.value===n}])},l(n),11,G)),64))])):z("",!0)]),t("div",{class:"relative"},[t("button",{onClick:O,class:"filter-select w-full flex justify-between items-center coverage-btn",type:"button"}," Очистить фильтры ")])]),t("table",Q,[e[4]||(e[4]=t("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[t("tr",null,[t("th",{class:"px-4 py-2 w-12"},"№"),t("th",{class:"px-4 py-2"},"Студент"),t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Стоимость обучения (тг)"),t("th",{class:"px-4 py-2"},"Cумма скидки (тг)"),t("th",{class:"px-4 py-2"},"К оплате (тг)")])],-1)),t("tbody",null,[(c(!0),d(w,null,F(f.value,(n,a)=>(c(),d("tr",{key:a,class:"border-t"},[t("td",W,[t("span",X,l(a+1),1)]),t("td",Y,l(n.name),1),t("td",Z,l(n.funding),1),t("td",ee,l(n.total),1),t("td",te,l(n.covered),1),t("td",ne,l(n.pay),1)]))),128))])]),t("div",se,[t("table",oe,[e[7]||(e[7]=t("thead",null,[t("tr",{class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},[t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Кол-во студентов"),t("th",{class:"px-4 py-2"},"Покрытие (%)"),t("th",{class:"px-4 py-2"},"Общая сумма покрытия (тг)"),t("th",{class:"px-4 py-2"},"Всего оплачено студентами (тг)")])],-1)),t("tbody",le,[(c(!0),d(w,null,F(j.value,(n,a)=>(c(),d("tr",{key:a,class:"divide-x divide-[#E0D7FF]"},[t("td",ae,l(n.type),1),t("td",re,l(n.count),1),t("td",de,l(n.percent),1),t("td",ce,l(n.covered),1),t("td",ie,l(n.paid),1)]))),128)),t("tr",ue,[e[5]||(e[5]=t("td",{class:"px-4 py-2"},"Итого",-1)),t("td",pe,l(y.value.count),1),e[6]||(e[6]=t("td",{class:"px-4 py-2"},"-",-1)),t("td",fe,l(y.value.covered),1),t("td",ve,l(y.value.paid),1)])])])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:q,class:"download-btn"},"Сохранить в Excel")])])}}},ge=N(_e,[["__scopeId","data-v-850532c9"]]);export{ge as default};
