import{_ as Y,r as i,o as I,a as J,c as b,k as P,b as d,d as n,e as t,l as m,m as _,h as g,z as R,t as o,f as k,x as j,T as V,n as h,F as K,i as q,J as F,K as G}from"./index-C-VbaQFe.js";const H={class:"p-6 font-inter"},O={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},Q={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},W={class:"relative"},X={class:"relative"},Z={class:"relative w-40"},tt={key:0,class:"absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg overflow-hidden"},et={class:"w-full bg-white border border-purple-200 rounded-lg overflow-hidden text-left mt-6"},st={class:"px-4 py-2"},ot={class:"w-6 h-6 rounded-md bg-[#F1ECFF] text-[rgb(98,82,254)] text-xs font-semibold flex items-center justify-center"},lt={class:"px-4 py-2"},nt={class:"px-4 py-2"},at={class:"px-4 py-2"},rt={class:"px-4 py-2"},ut={class:"mt-6 w-full rounded-xl overflow-hidden border border-[#E0D7FF]"},it={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold text-black"},dt={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},ct={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},pt={class:"bg-white px-6 py-4 text-sm flex justify-between border-b border-gray-200/60"},vt={class:"bg-[#ECE9FF] px-6 py-4 text-sm font-semibold flex justify-between"},ft={__name:"Debts",setup(bt){const a=i(null),r=i(null),p=i(!1),v=i(!1),C=i([]);I(async()=>{try{const s=await J.get("http://localhost:3000/reports/debts");C.value=s.data.map(e=>({id:e.id,student:e.full_name,amount:e.amount_remaining,paymentDate:"-",status:"Не оплачен",comment:""}))}catch(s){console.error("Ошибка при загрузке:",s)}});const w=b(()=>[...C.value].sort((s,e)=>s.id-e.id)),S=b(()=>w.value.reduce((s,e)=>s+(e.amount||0),0)),D=b(()=>0),E=b(()=>S.value-D.value),U=b(()=>a.value&&r.value?`${x(a.value)} - ${x(r.value)}`:"не выбран"),x=s=>new Date(s).toLocaleDateString("ru-RU");function $(s){if(p.value=!p.value,p.value){const e=s.target.getBoundingClientRect();popupPosition.value.start=`position: absolute; top: ${e.bottom+window.scrollY+5}px; left: ${e.left}px; z-index: 9999;`}}function B(s){if(v.value=!v.value,v.value){const e=s.target.getBoundingClientRect();popupPosition.value.end=`position: absolute; top: ${e.bottom+window.scrollY+5}px; left: ${e.left}px; z-index: 9999;`}}const L=()=>{p.value=!1},z=()=>{v.value=!1};function N(){f.value=!f.value}const A=()=>{const s=w.value.map(u=>({Студент:u.student,Сумма:u.amount,Статус:u.status,Комментарий:u.comment})),e=F.json_to_sheet(s),c=F.book_new();F.book_append_sheet(c,e,"Задолженности"),G(c,"Задолженности.xlsx")},y=i(""),f=i(!1);function T(){a.value=null,r.value=null,y.value="",f.value=!1}return(s,e)=>{const c=P("router-link"),u=P("Datepicker");return n(),d("div",H,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold mb-6"},"Задолженности",-1)),t("div",O,[m(c,{to:"/finance/reports/total-revenue",class:"tab-button"},{default:_(()=>e[4]||(e[4]=[g("Общая выручка")])),_:1,__:[4]}),m(c,{to:"/finance/reports/debts",class:"tab-button-active"},{default:_(()=>e[5]||(e[5]=[g("Задолженности")])),_:1,__:[5]}),m(c,{to:"/finance/reports/student-funding",class:"tab-button"},{default:_(()=>e[6]||(e[6]=[g("Финансирование студентов")])),_:1,__:[6]})]),t("div",Q,[t("div",W,[t("button",{onClick:$,class:"filter-select w-48"},o(a.value?x(a.value):"Начало периода"),1),(n(),R(V,{to:"body"},[p.value?(n(),d("div",{key:0,class:"datepicker-popup",style:j(s.popupPosition.start),ref:"startPickerRef"},[m(u,{modelValue:a.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>a.value=l),L]},null,8,["modelValue"])],4)):k("",!0)]))]),t("div",X,[t("button",{onClick:B,class:"filter-select w-48"},o(r.value?x(r.value):"Конец периода"),1),(n(),R(V,{to:"body"},[v.value?(n(),d("div",{key:0,class:"datepicker-popup",style:j(s.popupPosition.end),ref:"endPickerRef"},[m(u,{modelValue:r.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>r.value=l),z]},null,8,["modelValue"])],4)):k("",!0)]))]),t("div",Z,[t("button",{onClick:N,class:"filter-select w-full flex justify-between items-center",type:"button"},[g(o(y.value||"Статус")+" ",1),(n(),d("svg",{class:h(["w-4 h-4 ml-2 transform transition-transform duration-200",f.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[7]||(e[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),f.value?(n(),d("ul",tt,[t("li",{onClick:e[2]||(e[2]=l=>s.selectStatus("Оплачен")),class:h(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":y.value==="Оплачен"}])}," Оплачен ",2),t("li",{onClick:e[3]||(e[3]=l=>s.selectStatus("Не оплачен")),class:h(["cursor-pointer px-4 py-2 hover:bg-gray-100",{"text-[rgb(98,82,254)] font-medium":y.value==="Не оплачен"}])}," Не оплачен ",2)])):k("",!0)]),t("div",{class:"relative"},[t("button",{onClick:T,class:"filter-select w-full flex justify-between items-center"}," Очистить фильтры ")])]),t("table",et,[e[9]||(e[9]=t("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[t("tr",null,[t("th",{class:"px-4 py-2 w-12"},"№"),t("th",{class:"px-4 py-2"},"Студент"),t("th",{class:"px-4 py-2"},"К оплате (тг)"),t("th",{class:"px-4 py-2"},"Дата оплаты"),t("th",{class:"px-4 py-2"},"Статус"),t("th",{class:"px-4 py-2"},"Комментарий")])],-1)),t("tbody",null,[(n(!0),d(K,null,q(w.value,(l,M)=>(n(),d("tr",{key:l.id,class:"border-t"},[t("td",st,[t("div",ot,o(M+1),1)]),t("td",lt,o(l.student),1),t("td",nt,o(l.amount.toLocaleString("ru-RU")),1),t("td",at,o(l.paymentDate),1),e[8]||(e[8]=t("td",{class:"px-4 py-2"},[t("span",{class:"status-unpaid"},"Не оплачен")],-1)),t("td",rt,o(l.comment),1)]))),128))])]),t("div",ut,[t("div",it," Период "+o(U.value),1),t("div",dt,[e[10]||(e[10]=t("div",null,"Общая сумма платежей",-1)),t("div",null,o(S.value.toLocaleString("ru-RU"))+" ₸",1)]),t("div",ct,[e[11]||(e[11]=t("div",null,"Оплаченная сумма",-1)),t("div",null,o(D.value.toLocaleString("ru-RU"))+" ₸",1)]),t("div",pt,[e[12]||(e[12]=t("div",null,"Неоплаченная сумма",-1)),t("div",null,o(E.value.toLocaleString("ru-RU"))+" ₸",1)]),t("div",vt,[e[13]||(e[13]=t("div",null,"Общая задолженность",-1)),t("div",null,o(E.value.toLocaleString("ru-RU"))+" ₸",1)])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:A,class:"download-btn"},"Сохранить в Excel")])])}}},xt=Y(ft,[["__scopeId","data-v-f3014f68"]]);export{xt as default};
