import{l as N,s as V,r as g,o as B,a as P,b as z,c as _,m as A,e as d,k as c,f as t,w as I,v as Y,p as m,q as w,h as y,n as p,u as F,g as T,t as l,F as k,i as C,z as S,A as $}from"./index-DCJUFO9f.js";import{_ as G}from"./search-CKZYpkUj.js";const H={class:"p-6 font-inter"},J={class:"flex items-center justify-between mb-6"},K={class:"search-wrapper"},Q={class:"flex space-x-4 bg-[#F1EFFF] p-3 rounded-lg mb-4"},W={class:"filters-wrapper relative flex flex-wrap gap-3 mb-6"},X={class:"relative w-56"},Z={key:0,class:"funding-dropdown absolute z-50 mt-2 w-full bg-white border border-purple-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ee=["onClick"],te={key:0,class:"text-[rgb(98,82,254)]"},ne={class:"w-full bg-white text-left border border-purple-200 rounded-lg overflow-hidden"},se={class:"px-4 py-2"},oe={class:"inline-block bg-[#F1ECFF] text-[#6252FE] font-semibold text-xs rounded-full w-6 h-6 text-center leading-6"},ae={class:"px-4 py-2"},le={class:"px-4 py-2"},re={class:"px-4 py-2"},de={class:"px-4 py-2"},ce={class:"px-4 py-2"},ue={class:"mt-6 w-full bg-white overflow-hidden rounded-xl border border-[#E0D7FF]"},ie={class:"w-full text-sm text-left border-collapse"},pe={class:"divide-y divide-[#E0D7FF]"},fe={class:"px-4 py-2"},ve={class:"px-4 py-2"},ge={class:"px-4 py-2"},_e={class:"px-4 py-2"},ye={class:"px-4 py-2"},be={class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},he={class:"px-4 py-2"},xe={class:"px-4 py-2"},me={class:"px-4 py-2"},we={__name:"StudentFunding",setup(Fe){const b=V(),j=["TechOrda","Скидка 30%","Скидка 70%","Внутренний грант","Полная оплата"],r=g([]),i=g(!1),E=g([]),h=g("");B(async()=>{try{const s=await P.get("/api/students");document.addEventListener("click",D),E.value=s.data.map(e=>{const o=e.total_cost||0;let n=0,a="0%";e.funding_source==="TechOrda"||e.funding_source==="Внутренний грант"?(n=100,a="100%"):e.funding_source==="Скидка 70%"?(n=70,a="70%"):e.funding_source==="Скидка 30%"?(n=30,a="30%"):e.funding_source==="Полная оплата"&&(n=0,a="-");const u=Math.round(o*n/100),v=typeof e.paid_amount=="number"?e.paid_amount:o-u;return{name:e.full_name,funding:e.funding_source||"Не указано",percent:a,total:o.toLocaleString("ru-RU"),covered:u.toLocaleString("ru-RU"),pay:v.toLocaleString("ru-RU"),raw:{covered:u,pay:v}}})}catch(s){console.error("Ошибка при получении данных студентов:",s)}}),z(()=>{document.removeEventListener("click",D)});const L={TechOrda:1,"Скидка 70%":2,"Скидка 30%":3,"Внутренний грант":4},f=_(()=>E.value.filter(s=>r.value.length===0||r.value.includes(s.funding)).sort((s,e)=>(L[s.funding]||99)-(L[e.funding]||99)));function R(){i.value=!i.value}function U(s){const e=r.value.indexOf(s);e===-1?r.value.push(s):r.value.splice(e,1)}const q=_(()=>{const s={};for(const e of f.value)s[e.funding]||(s[e.funding]={type:e.funding,count:0,percentList:[],covered:0,paid:0}),s[e.funding].count++,s[e.funding].percentList.push(e.percent),s[e.funding].covered+=e.raw.covered||0,s[e.funding].paid+=e.raw.pay||0;return Object.values(s).map(e=>{const o=[...new Set(e.percentList)];return{type:e.type,count:e.count,percent:o.length===1?o[0]:"-",covered:e.covered.toLocaleString("ru-RU"),paid:e.paid.toLocaleString("ru-RU")}})});function D(s){var a,u;const e=s.target;document.querySelector(".funding-dropdown"),document.querySelector(".funding-btn");const o=document.querySelector(".coverage-dropdown"),n=document.querySelector(".coverage-btn");i.value&&!((a=document.querySelector(".funding-dropdown"))!=null&&a.contains(e))&&!((u=document.querySelector(".funding-btn"))!=null&&u.contains(e))&&(i.value=!1),showCoveragePercent.value&&!(o!=null&&o.contains(e))&&!(n!=null&&n.contains(e))&&(showCoveragePercent.value=!1)}function M(){r.value=[],i.value=!1}const x=_(()=>{let s=0,e=0,o=0;for(const n of f.value)s++,e+=n.raw.covered||0,o+=n.raw.pay||0;return{count:s,covered:e.toLocaleString("ru-RU"),paid:o.toLocaleString("ru-RU")}});function O(){const s=S.json_to_sheet(f.value.map(o=>({Студент:o.name,"Тип финансирования":o.funding,"Стоимость обучения":o.total,"Сумма покрытия":o.covered,"К оплате":o.pay}))),e=S.book_new();S.book_append_sheet(e,s,"Финансирование"),$(e,"Финансирование.xlsx")}return _(()=>{const s=endDate.value?new Date(endDate.value.getFullYear(),endDate.value.getMonth(),endDate.value.getDate()+1):null;return rows.value.filter(e=>{const o=new Date(e.date.split(".").reverse().join("-")),n=(!startDate.value||o>=startDate.value)&&(!s||o<s),a=!selectedCourse.value||e.course===selectedCourse.value,u=r.value.length===0||r.value.includes(e.payment),v=e.student.toLowerCase().includes(h.value.toLowerCase());return n&&a&&u&&v})}),(s,e)=>{const o=A("router-link");return c(),d("div",H,[t("div",J,[e[2]||(e[2]=t("h2",{class:"text-2xl font-bold mb-6"},"Финансирование студентов",-1)),t("div",K,[e[1]||(e[1]=t("img",{src:G,class:"search-icon"},null,-1)),I(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>h.value=n),type:"text",placeholder:"Поиск",class:"search-input"},null,512),[[Y,h.value]])])]),t("div",Q,[m(o,{to:"/finance/reports/total-revenue",class:p(["tab-button",{"tab-button-active":F(b).path==="/finance/reports/total-revenue"}])},{default:w(()=>e[3]||(e[3]=[y(" Общая выручка")])),_:1,__:[3]},8,["class"]),m(o,{to:"/finance/reports/debts",class:p(["tab-button",{"tab-button-active":F(b).path==="/finance/reports/debts"}])},{default:w(()=>e[4]||(e[4]=[y(" Задолженности")])),_:1,__:[4]},8,["class"]),m(o,{to:"/finance/reports/student-funding",class:p(["tab-button",{"tab-button-active":F(b).path==="/finance/reports/student-funding"}])},{default:w(()=>e[5]||(e[5]=[y(" Финансирование студентов")])),_:1,__:[5]},8,["class"])]),t("div",W,[t("div",X,[t("button",{onClick:R,class:"filter-select w-full flex justify-between items-center funding-btn",type:"button"},[y(l(r.value.length?r.value.join(", "):"Тип финансирования")+" ",1),(c(),d("svg",{class:p(["w-4 h-4 ml-2 transform transition-transform duration-200",i.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[6]||(e[6]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),i.value?(c(),d("ul",Z,[(c(),d(k,null,C(j,n=>t("li",{key:n,onClick:a=>U(n),class:"cursor-pointer px-4 py-2 hover:bg-gray-100 flex justify-between items-center"},[t("span",{class:p({"text-[rgb(98,82,254)] font-medium":r.value.includes(n)})},l(n),3),r.value.includes(n)?(c(),d("span",te,"✔")):T("",!0)],8,ee)),64))])):T("",!0)]),t("div",{class:"relative"},[t("button",{onClick:M,class:"filter-select w-full flex justify-between items-center coverage-btn",type:"button"}," Очистить фильтры ")])]),t("table",ne,[e[7]||(e[7]=t("thead",{class:"bg-[#ECE9FF] text-sm font-semibold"},[t("tr",null,[t("th",{class:"px-4 py-2 w-12"},"№"),t("th",{class:"px-4 py-2"},"Студент"),t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Стоимость обучения (тг)"),t("th",{class:"px-4 py-2"},"Cумма скидки (тг)"),t("th",{class:"px-4 py-2"},"К оплате (тг)")])],-1)),t("tbody",null,[(c(!0),d(k,null,C(f.value,(n,a)=>(c(),d("tr",{key:a,class:"border-t"},[t("td",se,[t("span",oe,l(a+1),1)]),t("td",ae,l(n.name),1),t("td",le,l(n.funding),1),t("td",re,l(n.total),1),t("td",de,l(n.covered),1),t("td",ce,l(n.pay),1)]))),128))])]),t("div",ue,[t("table",ie,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"bg-[#ECE9FF] font-semibold divide-x divide-[#E0D7FF]"},[t("th",{class:"px-4 py-2"},"Тип финансирования"),t("th",{class:"px-4 py-2"},"Кол-во студентов"),t("th",{class:"px-4 py-2"},"Покрытие (%)"),t("th",{class:"px-4 py-2"},"Общая сумма скидки (тг)"),t("th",{class:"px-4 py-2"},"Всего оплачено студентами (тг)")])],-1)),t("tbody",pe,[(c(!0),d(k,null,C(q.value,(n,a)=>(c(),d("tr",{key:a,class:"divide-x divide-[#E0D7FF]"},[t("td",fe,l(n.type),1),t("td",ve,l(n.count),1),t("td",ge,l(n.percent),1),t("td",_e,l(n.covered),1),t("td",ye,l(n.paid),1)]))),128)),t("tr",be,[e[8]||(e[8]=t("td",{class:"px-4 py-2"},"Итого",-1)),t("td",he,l(x.value.count),1),e[9]||(e[9]=t("td",{class:"px-4 py-2"},"-",-1)),t("td",xe,l(x.value.covered),1),t("td",me,l(x.value.paid),1)])])])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{onClick:O,class:"download-btn"},"Сохранить в Excel")])])}}},Se=N(we,[["__scopeId","data-v-acb1b926"]]);export{Se as default};
